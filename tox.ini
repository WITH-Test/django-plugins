[tox]
isolated_builds = True
envlist = clean,py{38,39,310}-django{32,40,41},report
requires =
    tox-pyenv
    tox-poetry
    poetry_core >= 1.2.0

[testenv]
allowlist_externals = poetry
deps =
    pytest
    coverage
    django32: Django>=3.2,<3.3
    django40: Django>=4.0,<4.1
    django41: Django>=4.1,<4.2

depends =
    py{38,39,310}: clean
    report: py{38,39,310}

changedir = {toxinidir}/example-project
commands =
    poetry run python -m coverage run manage.py -- test django_plugins --noinput --failfast

[testenv:report]
passenv =
    PPID
    COVERAGE_FILE='.coverage-$PPID'
deps = coverage
skip_install = true
commands =
;    poetry run python -m coverage combine
    poetry run python -m coverage html

[testenv:clean]
deps = coverage
skip_install = true
commands = poetry run python -m coverage erase
